{"version":3,"sources":["../../src/models/logger.ts"],"names":["logger","state","entityCount","typeCount","activityTimers","reducers","incrementActivityTimer","typeName","by","action","count","activity","setStatus","stopActivityTimer","end","createActivityTimer","reporter","pluginOptions","typeActivityTimer","activityTimer","useVerboseStyle","verbose","start"],"mappings":";;;;;AACA;;AAaA,MAAMA,MAAM,GAAG;AACbC,EAAAA,KAAK,EAAE;AACLC,IAAAA,WAAW,EAAE,CADR;AAELC,IAAAA,SAAS,EAAE,EAFN;AAGLC,IAAAA,cAAc,EAAE;AAHX,GADM;AAObC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,sBAAsB,CACpBL,KADoB,EAEpB;AACEM,MAAAA,QADF;AAEEC,MAAAA,EAFF;AAGEC,MAAAA,MAAM,GAAI;AAHZ,KAFoB,EAON;AACd,YAAMT,MAAM,GAAGC,KAAK,CAACG,cAAN,CAAqBG,QAArB,CAAf;;AAEA,UAAI,CAACP,MAAL,EAAa;AACX,eAAOC,KAAP;AACD;;AAED,UAAI,OAAOO,EAAP,KAAe,QAAnB,EAA4B;AAC1BR,QAAAA,MAAM,CAACU,KAAP,IAAgBF,EAAhB;AACAP,QAAAA,KAAK,CAACC,WAAN,IAAqBM,EAArB;AACD;;AAEDR,MAAAA,MAAM,CAACW,QAAP,CAAgBC,SAAhB,CAA2B,GAAEH,MAAO,IAAGT,MAAM,CAACU,KAAM,EAApD;AAEA,aAAOT,KAAP;AACD,KAvBO;;AAyBRY,IAAAA,iBAAiB,CACfZ,KADe,EAEf;AAAEM,MAAAA,QAAF;AAAYE,MAAAA,MAAM,GAAI;AAAtB,KAFe,EAGD;AACd,YAAMT,MAAM,GAAGC,KAAK,CAACG,cAAN,CAAqBG,QAArB,CAAf;;AAEA,UAAIP,MAAM,CAACU,KAAP,KAAiB,CAArB,EAAwB;AACtBV,QAAAA,MAAM,CAACW,QAAP,CAAgBC,SAAhB,CAA2B,GAAEH,MAAO,IAApC;AACD;;AAEDT,MAAAA,MAAM,CAACW,QAAP,CAAgBG,GAAhB;AAEA,aAAOb,KAAP;AACD,KAtCO;;AAwCRc,IAAAA,mBAAmB,CACjBd,KADiB,EAEjB;AACEM,MAAAA,QADF;AAEES,MAAAA,QAFF;AAGEC,MAAAA;AAHF,KAFiB,EAOH;AACd,UAAIhB,KAAK,CAACG,cAAN,CAAqBG,QAArB,CAAJ,EAAoC;AAClC,eAAON,KAAP;AACD;;AAED,YAAMiB,iBAAiB,GAAG;AACxBR,QAAAA,KAAK,EAAE,CADiB;AAExBC,QAAAA,QAAQ,EAAEK,QAAQ,CAACG,aAAT,CACR,wCAAiBZ,QAAjB,EAA2B;AACzBa,UAAAA,eAAe,EAAEH,aAAa,CAACI;AADN,SAA3B,CADQ;AAFc,OAA1B;;AASA,UAAIJ,aAAa,CAACI,OAAlB,EAA2B;AACzBH,QAAAA,iBAAiB,CAACP,QAAlB,CAA2BW,KAA3B;AACD;;AAEDrB,MAAAA,KAAK,CAACG,cAAN,CAAqBG,QAArB,IAAiCW,iBAAjC;AAEA,aAAOjB,KAAP;AACD;;AApEO;AAPG,CAAf;eA+EeD,M","sourcesContent":["import { Reporter } from \"gatsby\"\nimport { formatLogMessage } from \"~/utils/format-log-message\"\nimport { IPluginOptions } from \"./gatsby-api\"\n\ntype ITimerReporter = ReturnType<Reporter[\"activityTimer\"]>\n\nexport interface ILoggerState {\n  entityCount: number\n  typeCount: { [name: string]: number }\n  activityTimers: {\n    [name: string]: { count: number; activity: ITimerReporter }\n  }\n}\n\nconst logger = {\n  state: {\n    entityCount: 0,\n    typeCount: {},\n    activityTimers: {},\n  } as ILoggerState,\n\n  reducers: {\n    incrementActivityTimer(\n      state: ILoggerState,\n      {\n        typeName,\n        by,\n        action = `fetched`,\n      }: { typeName: string; by: number; action: string }\n    ): ILoggerState {\n      const logger = state.activityTimers[typeName]\n\n      if (!logger) {\n        return state\n      }\n\n      if (typeof by === `number`) {\n        logger.count += by\n        state.entityCount += by\n      }\n\n      logger.activity.setStatus(`${action} ${logger.count}`)\n\n      return state\n    },\n\n    stopActivityTimer(\n      state: ILoggerState,\n      { typeName, action = `fetched` }: { typeName: string; action: string }\n    ): ILoggerState {\n      const logger = state.activityTimers[typeName]\n\n      if (logger.count === 0) {\n        logger.activity.setStatus(`${action} 0`)\n      }\n\n      logger.activity.end()\n\n      return state\n    },\n\n    createActivityTimer(\n      state: ILoggerState,\n      {\n        typeName,\n        reporter,\n        pluginOptions,\n      }: { typeName: string; reporter: Reporter; pluginOptions: IPluginOptions }\n    ): ILoggerState {\n      if (state.activityTimers[typeName]) {\n        return state\n      }\n\n      const typeActivityTimer = {\n        count: 0,\n        activity: reporter.activityTimer(\n          formatLogMessage(typeName, {\n            useVerboseStyle: pluginOptions.verbose,\n          })\n        ),\n      }\n\n      if (pluginOptions.verbose) {\n        typeActivityTimer.activity.start()\n      }\n\n      state.activityTimers[typeName] = typeActivityTimer\n\n      return state\n    },\n  },\n}\n\nexport default logger\n"],"file":"logger.js"}