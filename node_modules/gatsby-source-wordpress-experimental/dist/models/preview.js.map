{"version":3,"sources":["../../src/models/preview.ts"],"names":["previewStore","state","inPreviewMode","nodePageCreatedCallbacks","nodeIdsToCreatedPages","pagePathToNodeDependencyId","reducers","setInPreviewMode","unSubscribeToPagesCreatedFromNodeById","nodeId","subscribeToPagesCreatedFromNodeById","sendPreviewStatus","clearPreviewCallbacks","saveNodePageState","page","path"],"mappings":";;;;AAAA;AACA;AAuDA,MAAMA,YAA2B,GAAG;AAClCC,EAAAA,KAAK,EAAE;AACLC,IAAAA,aAAa,EAAE,KADV;AAELC,IAAAA,wBAAwB,EAAE,EAFrB;AAGLC,IAAAA,qBAAqB,EAAE,EAHlB;AAILC,IAAAA,0BAA0B,EAAE;AAJvB,GAD2B;AAQlCC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,gBAAgB,CAACN,KAAD,EAAQC,aAAR,EAAuB;AACrCD,MAAAA,KAAK,CAACC,aAAN,GAAsBA,aAAtB;AAEA,aAAOD,KAAP;AACD,KALO;;AAORO,IAAAA,qCAAqC,CAACP,KAAD,EAAQ;AAAEQ,MAAAA;AAAF,KAAR,EAAoB;AAAA;;AACvD,mCAAIR,KAAK,CAACE,wBAAV,0DAAI,sBAAiCM,MAAjC,CAAJ,EAA8C;AAC5C,eAAOR,KAAK,CAACE,wBAAN,CAA+BM,MAA/B,CAAP;AACD;;AAED,aAAOR,KAAP;AACD,KAbO;;AAeRS,IAAAA,mCAAmC,CAACT,KAAD,EAAQ;AAAEQ,MAAAA,MAAF;AAAUE,MAAAA;AAAV,KAAR,EAAuC;AACxE;AACA;AACA;AACAV,MAAAA,KAAK,CAACE,wBAAN,CAA+BM,MAA/B,IAAyCE,iBAAzC;AAEA,aAAOV,KAAP;AACD,KAtBO;;AAwBRW,IAAAA,qBAAqB,CAACX,KAAD,EAAQ;AAC3BA,MAAAA,KAAK,CAACE,wBAAN,GAAiC,EAAjC;AAEA,aAAOF,KAAP;AACD,KA5BO;;AA8BRY,IAAAA,iBAAiB,CAACZ,KAAD,EAAQ;AAAEa,MAAAA,IAAF;AAAQL,MAAAA;AAAR,KAAR,EAA0B;AACzCR,MAAAA,KAAK,CAACG,qBAAN,CAA4BK,MAA5B,IAAsC;AACpCK,QAAAA;AADoC,OAAtC;AAIAb,MAAAA,KAAK,CAACI,0BAAN,CAAiCS,IAAI,CAACC,IAAtC,IAA8C;AAC5CN,QAAAA;AAD4C,OAA9C;AAIA,aAAOR,KAAP;AACD;;AAxCO;AARwB,CAApC;eAoDeD,Y","sourcesContent":["// `node` here is a Gatsby node\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type OnPageCreatedCallback = (node: any) => Promise<void>\n\nexport interface StoredPage {\n  path: string\n  updatedAt: number\n}\n\nexport interface IPreviewState {\n  inPreviewMode: boolean\n  nodePageCreatedCallbacks: {\n    [nodeId: string]: OnPageCreatedCallback\n  }\n  nodeIdsToCreatedPages: {\n    [nodeId: string]: {\n      page: StoredPage\n    }\n  }\n  pagePathToNodeDependencyId: {\n    [pageId: string]: {\n      nodeId: string\n    }\n  }\n}\n\nexport interface PreviewReducers {\n  subscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      sendPreviewStatus: OnPageCreatedCallback\n      modified: string\n    }\n  ) => IPreviewState\n  unSubscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n    }\n  ) => IPreviewState\n  clearPreviewCallbacks: (state: IPreviewState) => IPreviewState\n  saveNodePageState: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      page: StoredPage\n    }\n  ) => IPreviewState\n}\n\nexport interface IPreviewStore {\n  state: IPreviewState\n  reducers: PreviewReducers\n}\n\nconst previewStore: IPreviewStore = {\n  state: {\n    inPreviewMode: false,\n    nodePageCreatedCallbacks: {},\n    nodeIdsToCreatedPages: {},\n    pagePathToNodeDependencyId: {},\n  },\n\n  reducers: {\n    setInPreviewMode(state, inPreviewMode) {\n      state.inPreviewMode = inPreviewMode\n\n      return state\n    },\n\n    unSubscribeToPagesCreatedFromNodeById(state, { nodeId }) {\n      if (state.nodePageCreatedCallbacks?.[nodeId]) {\n        delete state.nodePageCreatedCallbacks[nodeId]\n      }\n\n      return state\n    },\n\n    subscribeToPagesCreatedFromNodeById(state, { nodeId, sendPreviewStatus }) {\n      // save the callback for this nodeId\n      // when a page is created from a node that has this id,\n      // the callback will be invoked\n      state.nodePageCreatedCallbacks[nodeId] = sendPreviewStatus\n\n      return state\n    },\n\n    clearPreviewCallbacks(state) {\n      state.nodePageCreatedCallbacks = {}\n\n      return state\n    },\n\n    saveNodePageState(state, { page, nodeId }) {\n      state.nodeIdsToCreatedPages[nodeId] = {\n        page,\n      }\n\n      state.pagePathToNodeDependencyId[page.path] = {\n        nodeId,\n      }\n\n      return state\n    },\n  } as PreviewReducers,\n}\n\nexport default previewStore\n"],"file":"preview.js"}