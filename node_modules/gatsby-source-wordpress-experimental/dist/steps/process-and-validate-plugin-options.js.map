{"version":3,"sources":["../../src/steps/process-and-validate-plugin-options.ts"],"names":["optionsProcessors","name","test","userPluginOptions","type","MediaItem","limit","processor","helpers","reporter","panic","Boolean","excludeFields","length","excludeFieldNames","log","warn","store","dispatch","remoteSchema","addFieldsToBlackList","schema","queryDepth","useVerboseStyle","processAndValidatePluginOptions","pluginOptions","forEach","toString","filteredUserPluginOptions"],"mappings":"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","sourcesContent":["import store from \"~/store\"\nimport { formatLogMessage } from \"~/utils/format-log-message\"\nimport isInteger from \"lodash/isInteger\"\nimport { IPluginOptions } from \"~/models/gatsby-api\"\nimport { GatsbyNodeApiHelpers } from \"~/utils/gatsby-types\"\ninterface IProcessorOptions {\n  userPluginOptions: IPluginOptions\n  helpers: GatsbyNodeApiHelpers\n}\n\ninterface OptionsProcessor {\n  name: string\n  test: (options: IProcessorOptions) => boolean\n  processor: (options: IProcessorOptions) => IPluginOptions | void\n}\n\nconst optionsProcessors: OptionsProcessor[] = [\n  {\n    name: `pluginOptions.type.MediaItem.limit is not allowed`,\n    test: ({ userPluginOptions }) =>\n      !!userPluginOptions?.type?.MediaItem?.limit,\n    processor: ({ helpers, userPluginOptions }) => {\n      helpers.reporter.panic(\n        formatLogMessage(\n          `PluginOptions.type.MediaItem.limit is an disallowed plugin option.\\nPlease remove the MediaItem.limit option from gatsby-config.js (currently set to ${userPluginOptions?.type?.MediaItem?.limit})\\n\\nMediaItem nodes are automatically limited to 0 and then fetched only when referenced by other node types. For example as a featured image, in custom fields, or in post_content.`\n        )\n      )\n    },\n  },\n  {\n    name: `excludeFields-renamed-to-excludeFieldNames`,\n    test: ({ userPluginOptions }) =>\n      Boolean(\n        userPluginOptions?.excludeFields?.length ||\n          userPluginOptions?.excludeFieldNames?.length\n      ),\n    processor: ({ helpers, userPluginOptions }: IProcessorOptions) => {\n      if (userPluginOptions?.excludeFields?.length) {\n        helpers.reporter.log(``)\n        helpers.reporter.warn(\n          formatLogMessage(\n            // @todo\n            `\\n\\nPlugin options excludeFields has been renamed to excludeFieldNames.\\nBoth options work for now, but excludeFields will be removed in a future version\\n(likely when we get to beta) in favour of excludeFieldNames.\\n\\n`\n          )\n        )\n      }\n\n      store.dispatch.remoteSchema.addFieldsToBlackList(\n        userPluginOptions.excludeFieldNames || userPluginOptions.excludeFields\n      )\n\n      return userPluginOptions\n    },\n  },\n  {\n    name: `queryDepth-is-not-a-positive-int`,\n    test: ({ userPluginOptions }: IProcessorOptions) =>\n      typeof userPluginOptions?.schema?.queryDepth !== `undefined` &&\n      (!isInteger(userPluginOptions?.schema?.queryDepth) ||\n        userPluginOptions?.schema?.queryDepth <= 0),\n    processor: ({ helpers, userPluginOptions }: IProcessorOptions) => {\n      helpers.reporter.log(``)\n      helpers.reporter.warn(\n        formatLogMessage(\n          `\\n\\npluginOptions.schema.queryDepth is not a positive integer.\\nUsing default value in place of provided value.\\n`,\n          { useVerboseStyle: true }\n        )\n      )\n\n      delete userPluginOptions.schema.queryDepth\n\n      return userPluginOptions\n    },\n  },\n]\n\nexport const processAndValidatePluginOptions = (\n  helpers: GatsbyNodeApiHelpers,\n  pluginOptions: IPluginOptions\n): IPluginOptions => {\n  let userPluginOptions = {\n    ...pluginOptions,\n  }\n\n  optionsProcessors.forEach(({ test, processor, name }) => {\n    if (!name) {\n      helpers.reporter.panic(\n        formatLogMessage(\n          `Plugin option filter is unnamed\\n\\n${test.toString()}\\n\\n${processor.toString()}`\n        )\n      )\n    }\n\n    if (test({ helpers, userPluginOptions })) {\n      const filteredUserPluginOptions = processor({\n        helpers,\n        userPluginOptions,\n      })\n\n      if (filteredUserPluginOptions) {\n        userPluginOptions = filteredUserPluginOptions\n      } else {\n        helpers.reporter.panic(\n          formatLogMessage(\n            `Plugin option filter ${name} didn't return a filtered options object`\n          )\n        )\n      }\n    }\n  })\n\n  return userPluginOptions\n}\n"],"file":"process-and-validate-plugin-options.js"}